(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[735],{6280:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/intervals",function(){return n(7652)}])},4544:function(t,e,n){"use strict";n.d(e,{oD:function(){return _},Wh:function(){return T},Yz:function(){return S},W1:function(){return k},ol:function(){return D}});var r=n(7294),a=n(2981);let i=(0,a.h)("api");class s{constructor(t){this.session=t}}class o extends s{get resource(){return this.session.resource(this.resourceName)}}let u=i.sub("intervals");class l extends o{async index(){let t=await this.resource.index();return u.warning("TODO: runtime parsing"),t.data}async find(t){let e=await this.resource.find(t);return u.warning("TODO: runtime parsing"),e.data}async create(t){u.debug("create: ",t);let e=await this.resource.create(t);return u.warning("TODO: runtime parsing"),e.data}async update(t){let{id:e,...n}=t;u.debug("create: ",n);let r=await this.resource.update(e,n);return u.warning("TODO: runtime parsing"),r.data}async delete(t){u.debug("delete: ",t);let e=await this.resource.delete(t);return u.warning("TODO: runtime parsing"),e.data}constructor(...t){super(...t),this.resourceName="intervals"}}var c=n(6162),d=n.n(c),h=n(361),f=n.n(h);let p=i.sub("memory");class g{get loadedDb(){return this.db?Promise.resolve(this.db):this.load().then(()=>{if(!this.db)throw Error("load db failed");return this.db})}resource(t){return new w(this.loadedDb,t,{afterWrite:()=>this.save()})}async load(){this.db=this.opts.load?f()(await this.opts.load()):{},p.debug("load",this.db)}async save(){var t,e;p.debug("save",this.db),this.db&&(null===(t=(e=this.opts).save)||void 0===t||t.call(e,this.db))}constructor(t={}){this.opts=t,this.db=void 0}}function v(t){return!!t&&"object"==typeof t&&"id"in t&&"string"==typeof t.id}class w{get data(){return this.db.then(t=>{let e=t[this.resourceName];if(e)return e;let n=[];return t[this.resourceName]=n,n})}async index(){return{data:f()(await this.data)}}async find(t){return{data:f()((await this.data).find(e=>v(e)&&e.id===t))}}async create(t){var e,n;let r={...t,..."id"in t?{}:{id:await this.getNextId()}};return p.debug("create",r),(await this.data).push(r),null===(e=(n=this.options).afterWrite)||void 0===e||e.call(n),{data:f()(r)}}async update(t,e){var n,r;let a=(await this.data).find(e=>v(e)&&e.id===t);if(!a)throw Error("Record not found: ".concat(t," (").concat(this.resourceName,")"));return Object.assign(a,e),null===(n=(r=this.options).afterWrite)||void 0===n||n.call(r),{data:f()(a)}}async delete(t){var e,n;let r=await this.data,a=r.find(e=>v(e)&&e.id===t);if(!a)throw Error("Record not found: ".concat(t," (").concat(this.resourceName,")"));let i=r.indexOf(a);return r.splice(i,1),null===(e=(n=this.options).afterWrite)||void 0===e||e.call(n),{data:f()(a)}}async getNextId(){let{data:t}=await this.index();return((d()(t.map(t=>v(t)?parseInt(t.id):0))||0)+1).toString()}constructor(t,e,n={}){this.db=t,this.resourceName=e,this.options=n}}let b="pump-data",m={},y=(0,a.h)("api-session");function x(t){let e=(m.session||(m.session=function(){let t=new g({save:async t=>{if(y.debug("save"),"undefined"==typeof localStorage){y.warning("localStorage not available");return}localStorage.setItem(b,JSON.stringify(t))},load:async()=>(y.debug("load"),"undefined"==typeof localStorage)?(y.warning("localStorage not available"),{}):JSON.parse(localStorage.getItem(b)||"{}")});return t.load(),t}()),m.session);return(0,r.useMemo)(()=>new t(e),[t,e])}function N(t){let[e,n]=(0,r.useState)(),a=(0,r.useRef)(t);return(0,r.useMemo)(()=>({status:e?"success":"loading",data:e,mutate:async t=>{let e=await a.current(t);return n(e),e}}),[e,a])}let O=(0,a.h)("useQuery");function j(t){let[e,n]=(0,r.useState)();return(0,r.useEffect)(()=>{t().then(t=>{O.debug("result",t),n(t)})},[t]),(0,r.useMemo)(()=>({status:e?"success":"loading",data:e}),[e])}function k(){let t=x(l);return j((0,r.useCallback)(()=>t.index(),[t]))}function S(t){let e=x(l);return j((0,r.useCallback)(async()=>t?e.find(t):void 0,[t,e]))}function _(){let t=x(l);return N(e=>t.create(e))}function D(){let t=x(l);return N(e=>t.update(e))}function T(){let t=x(l);return N(e=>t.delete(e))}},7652:function(t,e,n){"use strict";n.r(e),n.d(e,{Intervals:function(){return g},default:function(){return v}});var r=n(5893),a=n(1163),i=n.n(a),s=n(8207),o=n(9647),u=n(7294),l=n(2386),c=n(356),d=n(6141),h=n(6420),f=t=>{let{intervals:e,onSelect:n,onEdit:a,onDelete:i,confirmDelete:s=!0}=t,o=(0,u.useMemo)(()=>null==e?void 0:e.map(t=>(0,r.jsxs)(l.i.Tr,{onClick:()=>null==n?void 0:n(t),children:[(0,r.jsx)(l.i.Td,{children:t.name}),(0,r.jsx)(l.i.Td,{children:(0,r.jsxs)(c.Z,{justify:"flex-end",gap:"xs",children:[a&&(0,r.jsx)(h.Z,{size:18,onClick:e=>{e.preventDefault(),e.stopPropagation(),null==a||a(t)}}),i&&(0,r.jsx)(d.P,{onClick:e=>{e.preventDefault(),e.stopPropagation(),(!s||confirm('Are you sure yopu want to remove interval "'.concat(t.name,'"')))&&i(t)}})]})})]},"interval-row-".concat(t.id))),[e,n,a,i,s]);return(0,r.jsx)(l.i,{highlightOnHover:!0,children:(0,r.jsx)(l.i.Tbody,{children:o})})},p=n(4544);let g=()=>{let{data:t}=(0,p.W1)(),{mutate:e}=(0,p.Wh)();return(0,r.jsxs)(s.K,{children:[t&&(0,r.jsx)(f,{intervals:t,onSelect:t=>i().push("./intervals/show?id=".concat(t.id,"&backUrl=","/intervals")),onEdit:t=>i().push("./intervals/edit?id=".concat(t.id,"&backUrl=","/intervals")),onDelete:t=>e(t.id)}),(0,r.jsx)(o.z,{onClick:()=>i().push("./intervals/new"),children:"New Interval"})]})};var v=g}},function(t){t.O(0,[437,144,692,888,774,179],function(){return t(t.s=6280)}),_N_E=t.O()}]);