(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{6332:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/intervals/edit",function(){return r(5458)}])},9652:function(e,t,r){"use strict";var n=r(5893),s=r(7294),a=r(3303),i=r.n(a),u=r(8153);let o={display:"block",padding:0,margin:0,width:"100%"},l={rest:"#3ed54f",active:"#d53e4f",progress:"#00000055"};t.Z=e=>{let{interval:t,time:r,progress:a,width:d=100,height:c=3}=e,h=(0,u.T5)(t);r&&!a&&(a=r/h);let f=(0,s.useMemo)(()=>{let e=(0,u.iz)(t);return e.map((t,r)=>(0,n.jsx)("rect",{x:i()(e.slice(0,r),"duration")/h*d,y:"0",height:c,width:t.duration/h*d,fill:r%2?l.active:l.rest},"interval-bar-section-".concat(r)))},[t,h,d,c]);return(0,n.jsxs)("svg",{width:"300px",viewBox:[0,0,d,c].map(e=>e.toString()).join(" "),style:o,children:[f,a&&(0,n.jsx)("rect",{x:"0",y:"0",height:c,width:a*d,fill:l.progress})]})}},2460:function(e,t,r){"use strict";var n=r(5893),s=r(7294),a=r(8207),i=r(6414),u=r(356),o=r(6372),l=r(9647),d=r(3857),c=r.n(d),h=r(361),f=r.n(h),p=r(9652);t.Z=e=>{let{bar:t=!0,interval:r,onChange:d,onSubmit:h}=e,[m,g]=(0,s.useState)(c()({reps:{amount:1,duration:1,rest:10},sets:{amount:1,rest:30},name:""},r));(0,s.useEffect)(()=>{null==d||d(m)},[d,m]);let b=e=>t=>g(r=>{let n=e("number"==typeof t?t:parseInt(t));return c()(f()(r),n)});return(0,n.jsxs)(a.K,{children:[(0,n.jsx)(i.o,{label:"Interval Name",defaultValue:m.name,onChange:e=>g(t=>c()(f()(t),{name:e.target.value}))}),(0,n.jsxs)(u.Z,{children:[(0,n.jsx)(o.Y,{min:0,style:{width:100},placeholder:"Amount of reps",defaultValue:m.reps.amount||1,onChange:b(e=>({reps:{amount:e}})),label:"Reps"}),(0,n.jsx)(o.Y,{min:0,style:{width:100},placeholder:"Duration of a rep in seconds",defaultValue:m.reps.duration||10,onChange:b(e=>({reps:{duration:e}})),label:"Reps Dur"}),(0,n.jsx)(o.Y,{min:0,style:{width:100},placeholder:"Rest in seconds",defaultValue:m.reps.rest||30,onChange:b(e=>({reps:{rest:e}})),label:"Reps Rest"}),(0,n.jsx)(o.Y,{min:0,style:{width:100},placeholder:"Number of sets",defaultValue:m.sets.amount||3,onChange:b(e=>({sets:{amount:e}})),label:"Sets"}),(0,n.jsx)(o.Y,{min:0,style:{width:100},placeholder:"Rest between sets",defaultValue:m.sets.rest||90,onChange:b(e=>({sets:{rest:e}})),label:"Set Rest"})]}),t&&(0,n.jsx)(p.Z,{interval:m,width:1e3,height:20}),(0,n.jsx)(l.z,{onClick:()=>null==h?void 0:h(m),disabled:""===m.name,children:"Save Interval"})]})}},8153:function(e,t,r){"use strict";function n(e){return(e.reps.amount*e.reps.duration+(e.reps.amount-1)*e.reps.rest)*e.sets.amount+(e.sets.amount-1)*e.sets.rest}function s(e){return Array.from({length:e.sets.amount}).flatMap((t,r)=>[...0===r?[]:[{duration:e.sets.rest,type:"rest"}],...Array.from({length:e.reps.amount}).flatMap((t,r)=>[...0===r?[]:[{duration:e.reps.rest,type:"rest"}],{duration:e.reps.duration,type:"rep"}])])}function a(e){return e.reps.amount*(e.reps.duration+e.reps.rest)-e.reps.rest}function i(e,t){let r=0,n=a(e);for(let s=0;s<e.sets.amount;s++){if(r>t)return s-1;if(r+n>t)return s;r+=n+e.sets.rest}return e.sets.amount-1}function u(e,t){let r=(a(e)+e.sets.rest)*i(e,t);for(let n=0;n<e.reps.amount;n++){if(r>t)return n-1;if(r+e.reps.duration>t)return n;r+=e.reps.duration+e.reps.rest}return e.sets.amount-1}r.d(t,{GU:function(){return u},T5:function(){return n},TN:function(){return i},iz:function(){return s}})},4544:function(e,t,r){"use strict";r.d(t,{oD:function(){return C},Wh:function(){return _},Yz:function(){return k},W1:function(){return O},ol:function(){return E}});var n=r(7294),s=r(2981);let a=(0,s.h)("api");class i{constructor(e){this.session=e}}class u extends i{get resource(){return this.session.resource(this.resourceName)}}let o=a.sub("intervals");class l extends u{async index(){let e=await this.resource.index();return o.warning("TODO: runtime parsing"),e.data}async find(e){let t=await this.resource.find(e);return o.warning("TODO: runtime parsing"),t.data}async create(e){o.debug("create: ",e);let t=await this.resource.create(e);return o.warning("TODO: runtime parsing"),t.data}async update(e){let{id:t,...r}=e;o.debug("create: ",r);let n=await this.resource.update(t,r);return o.warning("TODO: runtime parsing"),n.data}async delete(e){o.debug("delete: ",e);let t=await this.resource.delete(e);return o.warning("TODO: runtime parsing"),t.data}constructor(...e){super(...e),this.resourceName="intervals"}}var d=r(6162),c=r.n(d),h=r(361),f=r.n(h);let p=a.sub("memory");class m{get loadedDb(){return this.db?Promise.resolve(this.db):this.load().then(()=>{if(!this.db)throw Error("load db failed");return this.db})}resource(e){return new b(this.loadedDb,e,{afterWrite:()=>this.save()})}async load(){this.db=this.opts.load?f()(await this.opts.load()):{},p.debug("load",this.db)}async save(){var e,t;p.debug("save",this.db),this.db&&(null===(e=(t=this.opts).save)||void 0===e||e.call(t,this.db))}constructor(e={}){this.opts=e,this.db=void 0}}function g(e){return!!e&&"object"==typeof e&&"id"in e&&"string"==typeof e.id}class b{get data(){return this.db.then(e=>{let t=e[this.resourceName];if(t)return t;let r=[];return e[this.resourceName]=r,r})}async index(){return{data:f()(await this.data)}}async find(e){return{data:f()((await this.data).find(t=>g(t)&&t.id===e))}}async create(e){var t,r;let n={...e,..."id"in e?{}:{id:await this.getNextId()}};return p.debug("create",n),(await this.data).push(n),null===(t=(r=this.options).afterWrite)||void 0===t||t.call(r),{data:f()(n)}}async update(e,t){var r,n;let s=(await this.data).find(t=>g(t)&&t.id===e);if(!s)throw Error("Record not found: ".concat(e," (").concat(this.resourceName,")"));return Object.assign(s,t),null===(r=(n=this.options).afterWrite)||void 0===r||r.call(n),{data:f()(s)}}async delete(e){var t,r;let n=await this.data,s=n.find(t=>g(t)&&t.id===e);if(!s)throw Error("Record not found: ".concat(e," (").concat(this.resourceName,")"));let a=n.indexOf(s);return n.splice(a,1),null===(t=(r=this.options).afterWrite)||void 0===t||t.call(r),{data:f()(s)}}async getNextId(){let{data:e}=await this.index();return((c()(e.map(e=>g(e)?parseInt(e.id):0))||0)+1).toString()}constructor(e,t,r={}){this.db=e,this.resourceName=t,this.options=r}}let w="pump-data",v={},y=(0,s.h)("api-session");function x(e){let t=(v.session||(v.session=function(){let e=new m({save:async e=>{if(y.debug("save"),"undefined"==typeof localStorage){y.warning("localStorage not available");return}localStorage.setItem(w,JSON.stringify(e))},load:async()=>(y.debug("load"),"undefined"==typeof localStorage)?(y.warning("localStorage not available"),{}):JSON.parse(localStorage.getItem(w)||"{}")});return e.load(),e}()),v.session);return(0,n.useMemo)(()=>new e(t),[e,t])}function j(e){let[t,r]=(0,n.useState)(),s=(0,n.useRef)(e);return(0,n.useMemo)(()=>({status:t?"success":"loading",data:t,mutate:async e=>{let t=await s.current(e);return r(t),t}}),[t,s])}let N=(0,s.h)("useQuery");function S(e){let[t,r]=(0,n.useState)();return(0,n.useEffect)(()=>{e().then(e=>{N.debug("result",e),r(e)})},[e]),(0,n.useMemo)(()=>({status:t?"success":"loading",data:t}),[t])}function O(){let e=x(l);return S((0,n.useCallback)(()=>e.index(),[e]))}function k(e){let t=x(l);return S((0,n.useCallback)(async()=>e?t.find(e):void 0,[e,t]))}function C(){let e=x(l);return j(t=>e.create(t))}function E(){let e=x(l);return j(t=>e.update(t))}function _(){let e=x(l);return j(t=>e.delete(t))}},9507:function(e,t,r){"use strict";var n=r(1163),s=r(7294);t.Z=function(e){let{query:t}=(0,n.useRouter)();return(0,s.useMemo)(()=>{try{return{params:e(t),query:t}}catch(e){return{error:e,query:t}}},[t,e])}},5458:function(e,t,r){"use strict";r.r(t),r.d(t,{EditInterval:function(){return f}});var n=r(5893),s=r(7294),a=r(1163),i=r.n(a),u=r(8207),o=r(1604),l=r(2460),d=r(9507),c=r(4544);let h=o.z.object({id:o.z.string(),backUrl:o.z.string().optional()}),f=()=>{let{params:e}=(0,d.Z)(h.parse),{data:t}=(0,c.Yz)(null==e?void 0:e.id),{mutate:r}=(0,c.ol)(),a=(0,s.useCallback)(async n=>{t&&(console.log({values:n}),await r({...n,id:t.id}),i().push((null==e?void 0:e.backUrl)||"/intervals"))},[r,t,null==e?void 0:e.backUrl]);return(0,n.jsxs)(u.K,{children:[(0,n.jsx)("h1",{children:"Edit"}),t&&(0,n.jsx)(l.Z,{interval:t,onSubmit:a})]})};t.default=f}},function(e){e.O(0,[437,303,144,604,825,263,888,774,179],function(){return e(e.s=6332)}),_N_E=e.O()}]);